"use strict";define("/dist/courses/picture",["uploadify","Jcrop","form"],function(t,i,s){function e(){o&&o.destroy(),a.Jcrop({boxWidth:400,aspectRatio:2},function(){o=this;var t=this.ui.stage.width,i=this.ui.stage.height,s=void 0,e=void 0,a=void 0,u=void 0;s=0,e=(i-t/2)/2,a=t,u=t/2,this.newSelection(),this.setSelect([s,e,a,u]),thumbnail=this.initComponent("Thumbnailer",{width:240,height:120,thumb:".thumb"}),$(".jcrop-thumb").css({left:0,top:0})})}t("uploadify"),t("Jcrop"),t("form");var a=$(".preview img"),o=void 0;a.parent().on("cropmove cropend",function(t,i,s){$("#x").val(s.x),$("#y").val(s.y),$("#w").val(s.w),$("#h").val(s.h)}),$("#cutBtn").on("click",function(){var t=$(this).attr("data-status");return"cut"===t?(e(),void $(this).val("保存图片").attr("data-status","save")):($("#coords").ajaxSubmit({url:"/courses/crop",type:"post",success:function(t){alert(t.msg),1e4===t.code&&(location.href="/courses/lesson/"+t.result.cs_id)}}),!1)}),$("#upfile").uploadify({width:"85px",height:"auto",fileObjName:"upfile",formData:{cs_id:$("#csId").val()},buttonClass:"btn btn-success btn-sm",fileSizeLimit:"2MB",fileTypeExts:"*.gif; *.jpg; *.png",buttonText:"选择图片",swf:"/assets/uploadify/uploadify.swf",itemTemplate:"<span></span>",uploader:"/courses/upfile",onUploadSuccess:function(t,i){var i=JSON.parse(i);a.attr("src","/original/"+i.filename),$("#cover").val(i.filename),$("#cutBtn").prop("disabled",!1),$("#cutBtn").val("保存图片").attr("data-status","save"),e()}})});